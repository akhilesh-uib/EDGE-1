<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Groundwater Drought Map</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  body { font-family: Arial, sans-serif; margin: 0; }
  h2 { padding: 10px; }
  #map { height: 500px; }
  #info {
    padding: 12px;
    border-top: 1px solid #ccc;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
  }
  th {
    background: #f4f4f4;
  }
</style>
</head>

<body>

<h2>Groundwater Wells and Drought Summary</h2>

<div id="map"></div>

<div id="info">
  <b>Click a station to see drought summary</b>
  <div id="drought-table"></div>
</div>

<script>

// --------------------------------------------------
// Load data
// --------------------------------------------------
let metadata, droughts;

Promise.all([
  fetch("data/metadata.json").then(r => r.json()),
  fetch("data/drought_summary.json").then(r => r.json())
]).then(data => {
  metadata = data[0];
  droughts = data[1];
  initMap();
});

// --------------------------------------------------
// Initialize map
// --------------------------------------------------
function initMap() {

  let map = L.map("map").setView([56, 14], 5);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap contributors"
  }).addTo(map);

  metadata.forEach(st => {

    let marker = L.circleMarker(
      [st.Latitude, st.Longitude],
      { radius: 6, color: "blue" }
    ).addTo(map);

    marker.bindPopup(st.station_name);

    marker.on("click", () => showDroughtSummary(st.station_name));
  });
}

// --------------------------------------------------
// Show drought table
// --------------------------------------------------
function showDroughtSummary(station) {

  let dr = droughts.filter(d => d.Station === station);
  let container = document.getElementById("drought-table");

  if (dr.length === 0) {
    container.innerHTML = `<p><b>${station}</b>: No droughts detected.</p>`;
    return;
  }

  let html = `<h3>${station}</h3>`;
  html += `<table>
    <tr>
      <th>Start</th>
      <th>End</th>
      <th>Duration (months)</th>
      <th>Magnitude</th>
      <th>Lowest SGI</th>
      <th>Date of Lowest SGI</th>
    </tr>`;

  dr.forEach(d => {
    html += `<tr>
      <td>${d.Start}</td>
      <td>${d.End}</td>
      <td>${d.Duration_months}</td>
      <td>${d.Magnitude}</td>
      <td>${d.Lowest_SGI}</td>
      <td>${d.Lowest_SGI_date}</td>
    </tr>`;
  });

  html += `</table>`;
  container.innerHTML = html;
}

</script>

</body>
</html>
